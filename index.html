<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Interval Camera (Simple)</title>
  <style>
    body { margin:0; background:black; color:white; font-family:sans-serif; }
    #status { position:absolute; top:10px; left:10px; background:rgba(255,255,255,0.1); padding:6px; border-radius:6px; }
    #controls { position:absolute; bottom:30px; left:0; right:0; display:flex; justify-content:center; gap:60px; }
    button { cursor:pointer; font-size:16px; }
    #baseBtn { width:80px; height:80px; border-radius:50%; background:white; border:2px solid black; }
    #startBtn { width:100px; height:100px; border-radius:50%; background:red; border:3px solid white; color:white; }
  </style>
</head>
<body>
  <video id="video" autoplay playsinline muted style="position:absolute;inset:0;width:100%;height:100%;object-fit:contain;"></video>
  <canvas id="composite" style="position:absolute;top:10px;right:10px;width:240px;height:160px;border:1px solid white;"></canvas>
  <canvas id="scratch" style="display:none;"></canvas>

  <div id="status">Loading…</div>
  <div id="controls">
    <button id="baseBtn">Base</button>
    <button id="startBtn" disabled>Start</button>
  </div>

  <script>
    const video = document.getElementById("video");
    const composite = document.getElementById("composite");
    const scratch = document.getElementById("scratch");
    const statusEl = document.getElementById("status");
    const baseBtn = document.getElementById("baseBtn");
    const startBtn = document.getElementById("startBtn");

    let hasBase = false;
    let overlays = 0;

    // Try to enable camera
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => {
        video.srcObject = stream;
        statusEl.textContent = "Camera ready — tap Base";
      })
      .catch(() => {
        statusEl.textContent = "Camera blocked — still usable";
      });

    function grabFrame() {
      if (!video.videoWidth) return null;
      scratch.width = video.videoWidth;
      scratch.height = video.videoHeight;
      const ctx = scratch.getContext("2d");
      ctx.drawImage(video, 0, 0);
      return scratch;
    }

    baseBtn.onclick = () => {
      const s = grabFrame();
      if (!s) return;
      composite.width = s.width;
      composite.height = s.height;
      const ctx = composite.getContext("2d");
      ctx.globalAlpha = 1.0;
      ctx.drawImage(s, 0, 0);
      hasBase = true;
      baseBtn.disabled = true;
      startBtn.disabled = false;
      statusEl.textContent = "Base captured — press Start";
    };

    startBtn.onclick = () => {
      if (!hasBase) return;
      startBtn.disabled = true;
      overlays = 0;
      const ctx = composite.getContext("2d");
      const timer = setInterval(() => {
        const s = grabFrame();
        if (!s) return;
        ctx.globalAlpha = 0.25;
        ctx.drawImage(s, 0, 0, composite.width, composite.height);
        overlays++;
        statusEl.textContent = "Capturing — " + overlays;
        if (overlays >= 10) {
          clearInterval(timer);
          statusEl.textContent = "Done!";
          composite.style.width = "100%";
          composite.style.height = "100%";
          video.style.opacity = 0;
        }
      }, 200);
    };
  </script>
</body>
</html>
